<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Zarządzanie Zadaniami</title>
  <link rel="stylesheet" href="/static/style.css">
  <script>
    let editingId = null;

    async function loadZadania() {
      const res = await fetch('/api/zadania');
      const zadania = await res.json();
      const list = document.getElementById('zadania');
      list.innerHTML = zadania.map(z => `
        <li>
          <strong>${z.tytul}</strong> (${z.priorytet})<br>
          ${z.opis}<br>
          Termin: ${z.deadline}<br>
          Status: ${z.status}<br>
          Estimated time: ${z.estimated_time} h<br>
          <button onclick="editZadanie(${z.id}, '${z.tytul}', '${z.opis}', '${z.deadline}', '${z.priorytet}', '${z.status}', ${z.estimated_time})">Edytuj</button>
          <button onclick="deleteZadanie(${z.id})">Usuń</button>
        </li>
      `).join('');
    }

    async function addZadanie() {
      const tytul = document.getElementById('tytul').value;
      const opis = document.getElementById('opis').value;
      const deadline = document.getElementById('deadline').value;
      const priorytet = document.getElementById('priorytet').value;
      const status = document.getElementById('status').value;
      const estimated_time = parseFloat(document.getElementById('estimated_time').value);

      if (!tytul || !opis || !deadline || !priorytet) {
        alert("Wypełnij wszystkie pola!");
        return;
      }

      const payload = { tytul, opis, deadline, priorytet, status, estimated_time };

      if (editingId) {
        await fetch('/api/zadania/' + editingId, {
          method: 'PUT',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        editingId = null;
        document.getElementById('addBtn').innerText = "Dodaj";
      } else {
        await fetch('/api/zadania', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
      }

      clearForm();
      loadZadania();
    }

    function editZadanie(id, tytul, opis, deadline, priorytet, status, estimated_time) {
      document.getElementById('tytul').value = tytul;
      document.getElementById('opis').value = opis;
      document.getElementById('deadline').value = deadline;
      document.getElementById('priorytet').value = priorytet;
      document.getElementById('status').value = status;
      document.getElementById('estimated_time').value = estimated_time;
      document.getElementById('addBtn').innerText = "Zapisz zmiany";
      editingId = id;
    }

    async function deleteZadanie(id) {
      await fetch('/api/zadania/' + id, { method: 'DELETE' });
      loadZadania();
    }

    function clearForm() {
      document.getElementById('tytul').value = '';
      document.getElementById('opis').value = '';
      document.getElementById('deadline').value = '';
      document.getElementById('priorytet').value = '';
      document.getElementById('status').value = '';
      document.getElementById('estimated_time').value = '';
    }

    window.onload = loadZadania;
  </script>
</head>
<body>
  <h1>Lista Zadań</h1>
  <ul id="zadania"></ul>

  <h2>Dodaj / Edytuj zadanie</h2>
  <input id="tytul" placeholder="Tytuł">
  <input id="opis" placeholder="Opis">
  <input id="deadline" type="date">
  <input id="priorytet" placeholder="Priorytet (np. wysoki)">
  <input id="status" placeholder="Status (open/in progress/done)">
  <input id="estimated_time" type="number" step="0.1" placeholder="Estimated time (h)">
  <button id="addBtn" onclick="addZadanie()">Dodaj</button>
</body>
</html>
